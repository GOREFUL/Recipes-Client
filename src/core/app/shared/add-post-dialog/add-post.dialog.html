<h2 class="text-xl font-semibold mb-4" style="color:var(--text)">Add New Post</h2>

<form [formGroup]="formGroup" (ngSubmit)="onSubmit()" class="space-y-4">
  <!-- Name -->
  <mat-form-field appearance="fill" class="w-full">
    <mat-label>Name*</mat-label>
    <input matInput formControlName="name" required />
    <mat-error *ngIf="f.name.touched && f.name.invalid">Name is required</mat-error>
  </mat-form-field>

  <!-- Description -->
  <mat-form-field appearance="fill" class="w-full">
    <mat-label>Description</mat-label>
    <textarea matInput rows="3" formControlName="description"></textarea>
    <mat-hint align="end">{{ (f.description.value?.length || 0) }}/500</mat-hint>
    <mat-error *ngIf="f.description.hasError('maxlength')">Max 500 characters</mat-error>
  </mat-form-field>

  <!-- Video picker (drag & drop + click) -->
  <div
    class="file-drop"
    (click)="fileInput.click()"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    [class.file-drop--hover]="isHovering"
  >
    <div class="flex items-center gap-2 pointer-events-none">
      <mat-icon>cloud_upload</mat-icon>
      <div>
        <div class="text-sm">Drop video here or <span class="underline">browse</span></div>
        <div class="text-xs" style="color:var(--muted)">MP4 / WebM / Ogg, up to {{ maxSizeMB }}MB</div>
      </div>
    </div>
    <input #fileInput type="file" accept="video/*" class="hidden" (change)="onFileSelected($event)" />
  </div>

  <!-- Selected file info / errors -->
  <div *ngIf="f.video.value as v" class="text-sm">
    <div><span style="color:var(--muted)">Selected:</span> {{ v.name }} ({{ fileSize(v.size) }})</div>
    <div class="mt-2">
      <video *ngIf="previewUrl" [src]="previewUrl" controls style="width:100%;border-radius:12px;outline:none"></video>
    </div>
    <div class="mt-2">
      <button type="button" class="btn btn-ghost" (click)="clearVideo()">
        <mat-icon>close</mat-icon> Remove video
      </button>
    </div>
  </div>
  <mat-error *ngIf="videoError" class="block">{{ videoError }}</mat-error>

  <!-- Actions -->
  <div class="flex justify-end gap-2 pt-2">
    <button mat-button type="button" (click)="onClose()">Cancel</button>
    <button mat-flat-button color="primary" type="submit" [disabled]="formGroup.invalid || !!videoError">Add Post</button>
  </div>
</form>
