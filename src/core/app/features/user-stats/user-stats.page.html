<div class="max-w-xl mx-auto p-4 space-y-4">
  <!-- Header + period switch -->
  <div class="flex items-center justify-between">
    <h1 class="text-xl font-bold">Your Nutrition Stats</h1>
    <div class="flex gap-2">
      <button
        class="px-3 py-1 rounded border hover:bg-gray-50"
        [class.bg-gray-900]="period() === '7d'"
        [class.text-white]="period() === '7d'"
        [class.border-gray-900]="period() === '7d'"
        (click)="setPeriod('7d')"
      >7 days</button>
      <button
        class="px-3 py-1 rounded border hover:bg-gray-50"
        [class.bg-gray-900]="period() === '30d'"
        [class.text-white]="period() === '30d'"
        [class.border-gray-900]="period() === '30d'"
        (click)="setPeriod('30d')"
      >30 days</button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="text-sm text-gray-500">Loading...</div>

  <ng-container *ngIf="!loading()">
    <!-- KPI cards -->
    <div class="grid grid-cols-2 gap-3">
      <div class="p-3 rounded-xl border ">
        <div class="text-sm text-gray-500">Avg Calories</div>
        <div class="text-2xl font-semibold">{{ avgCalories() }} kcal</div>
      </div>
      <div class="p-3 rounded-xl border ">
        <div class="text-sm text-gray-500">Total Meals Cooked</div>
        <div class="text-2xl font-semibold">{{ totalMeals() }}</div>
      </div>
      <div class="p-3 rounded-xl border ">
        <div class="text-sm text-gray-500">Protein (Σ)</div>
        <div class="text-2xl font-semibold">{{ totalProtein() }} g</div>
      </div>
      <div class="p-3 rounded-xl border ">
        <div class="text-sm text-gray-500">Carbs (Σ)</div>
        <div class="text-2xl font-semibold">{{ totalCarbs() }} g</div>
      </div>
      <div class="p-3 rounded-xl border  col-span-2">
        <div class="text-sm text-gray-500">Fat (Σ)</div>
        <div class="text-2xl font-semibold">{{ totalFat() }} g</div>
      </div>
    </div>

    <!-- Macros donut -->
    <div class="p-4 rounded-xl border ">
      <div class="flex items-center justify-between mb-2">
        <div class="font-semibold">Macros split</div>
        <div class="text-sm text-gray-500">
          P {{ macro().p }}% • C {{ macro().c }}% • F {{ macro().f }}%
        </div>
      </div>

      <div class="flex items-center gap-4">
        <svg viewBox="0 0 140 140" class="w-40 h-40">
          <!-- background ring -->
          <circle cx="70" cy="70" r="54" fill="none" stroke="#e5e7eb" stroke-width="16" />

          <!-- protein segment -->
          <circle cx="70" cy="70" r="54" fill="none" stroke-width="16"
                  [attr.stroke-dasharray]="donutProtein().dasharray"
                  [attr.stroke-dashoffset]="donutProtein().dashoffset"
                  stroke-linecap="butt" stroke="currentColor" class="text-blue-600" />

          <!-- carbs -->
          <circle cx="70" cy="70" r="54" fill="none" stroke-width="16"
                  [attr.stroke-dasharray]="donutCarbs().dasharray"
                  [attr.stroke-dashoffset]="donutCarbs().dashoffset"
                  stroke-linecap="butt" stroke="currentColor" class="text-green-600" />

          <!-- fat -->
          <circle cx="70" cy="70" r="54" fill="none" stroke-width="16"
                  [attr.stroke-dasharray]="donutFat().dasharray"
                  [attr.stroke-dashoffset]="donutFat().dashoffset"
                  stroke-linecap="butt" stroke="currentColor" class="text-yellow-500" />
        </svg>

        <div class="text-sm">
          <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-blue-600"></span> Protein</div>
          <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-600"></span> Carbs</div>
          <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> Fat</div>
        </div>
      </div>
    </div>

    <!-- Calories line chart -->
    <div class="p-4 rounded-xl border ">
      <div class="flex items-center justify-between mb-2">
        <div class="font-semibold">Calories trend</div>
        <div class="text-sm text-gray-500">per day</div>
      </div>

      <svg viewBox="0 0 340 140" class="w-full h-40">
        <line x1="10" y1="120" x2="330" y2="120" stroke="#e5e7eb" stroke-width="1" />
        <line x1="10" y1="20"  x2="10"  y2="120" stroke="#e5e7eb" stroke-width="1" />
        <path [attr.d]="caloriesPath()" fill="none" stroke="currentColor" stroke-width="2" class="text-indigo-600"/>
      </svg>

      <div class="mt-2 grid"
           [ngClass]="{'grid-cols-7': period()==='7d', 'grid-cols-6': period()==='30d'}">
        <ng-container *ngIf="entries() as data">
          <div *ngIf="period()==='7d'; else monthLabels"
               class="col-span-7 flex justify-between text-[10px] text-gray-500">
            <span *ngFor="let d of data">{{ d.date.slice(5) }}</span>
          </div>
          <ng-template #monthLabels>
            <div class="col-span-6 flex justify-between text-[10px] text-gray-500">
              <span *ngFor="let d of data; index as i" [class.invisible]="i % 5 !== 0">{{ d.date.slice(5) }}</span>
            </div>
          </ng-template>
        </ng-container>
      </div>
    </div>

    <!-- Cooking frequency bars -->
    <div class="p-4 rounded-xl border ">
      <div class="flex items-center justify-between mb-2">
        <div class="font-semibold">Cooking frequency</div>
        <div class="text-sm text-gray-500">times cooked per day</div>
      </div>

      <div class="flex items-end gap-1 h-36">
        <ng-container *ngIf="entries() as data">
          <div *ngFor="let e of data" class="w-3 bg-emerald-500 rounded-t"
               [style.height.%]="(e.cookedMeals/3)*100"
               [title]="e.date + ': ' + e.cookedMeals"></div>
        </ng-container>
      </div>
    </div>
  </ng-container>
</div>
